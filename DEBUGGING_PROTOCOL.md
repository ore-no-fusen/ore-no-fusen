# Antigravity Debugging Protocol (AGDP)

このドキュメントは、バグ修正やトラブルシューティングを行う際の厳格な標準手順（SOP）を定義します。
開発者（AIエージェント）は、このプロトコルに完全に従わなければなりません。

## 🚫 禁止事項 (Non-Negotiables)
1.  **推測による修正 (Guesswork Engineering) の禁止**: ログや証拠なしにコードを変更してはならない。
2.  **無断修正の禁止**: Phase III でユーザーの明確な承認を得る前に、Phase IV (実装) に進んではならない。
3.  **コンテキストの無視の禁止**: 過去の経緯や既存の設計思想 (DOD, Effect Pattern等) を無視した修正を行ってはならない。

---

## Phase I: Observation (観察)
**目的**: 「何が起きているか」を客観的な事実として収集する。

*   **Action**:
    *   ログの確認 (`log_debug`, `log_error` 等の出力確認)
    *   現状の挙動確認 (スクリーンショット、再現手順の確立)
    *   コードの現状確認 (`view_file` による静的解析)
*   **Output**: 
    *   観測された事実のリスト
    *   エラーログの抜粋
    *   「期待される動作」と「実際の動作」の差異

## Phase II: Hypothesis (仮説)
**目的**: 観察された事実に基づき、「なぜ起きているか」の仮説を立てる。

*   **Action**:
    *   事実とコードロジックの照らし合わせ
    *   原因の候補（Root CAUSE candidates）の列挙
    *   検証方法の策定
*   **Output**:
    *   最も確からしい仮説
    *   それを裏付ける根拠

## Phase III: Plan & Visualization (計画と図解)
**目的**: 「どう直すか」を明確にし、ユーザーの合意を得る。

*   **Action**:
    *   修正方針の策定
    *   **図解**: シーケンス図、フローチャート、状態遷移図などを用いて、変更前後のロジックを可視化する (Mermaid記法推奨)。
    *   影響範囲の特定 (Side Effect Analysis)
*   **Output**:
    *   修正計画書 (Implementation Plan)
    *   可視化されたロジック図
    *   **【ユーザー承認ポイント】**: ここでユーザーに「GOサイン」をもらうまで、絶対に実装に進まないこと。

## Phase IV: Implementation (実装)
**目的**: 承認された計画に基づき、コードを修正する。

*   **Action**:
    *   コードの修正
    *   テストの実行・修正確認
    *   ドキュメントの更新 (task.md, walkthrough.md 等)
*   **Output**:
    *   修正されたコード
    *   解決確認の報告

---

## 運用ルール
*   エージェントは問題に直面した際、まず「今どのフェーズにいるか」を宣言すること。
*   ユーザーから「AGDPに従え」と言われた場合は、直ちに Phase I からやり直すこと。
