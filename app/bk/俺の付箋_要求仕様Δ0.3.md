# 俺の付箋 (Ore no Fusen) 要求仕様書 Δ0.3

## プロジェクト概要
**「俺の付箋」**は、Obsidian Vault などのローカル Markdown ファイルを、デスクトップ上に貼り付けられた「付箋」のように軽快に操作・編集するためのミニマリスト向けアプリケーションです。

## 主要機能
- **ステルス・オーケストレーター (Stealth Orchestrator)**: [NEW]
  - アプリケーション全体で**ベースフォルダは1つ**に限定。
  - メインウィンドウは通常 **非表示 (hidden)** で動作し、バックグラウンドで付箋群を管理する司令塔として機能。
  - 起動時にベースフォルダ内の全 `.md` ファイルを自動的にスキャンし、前回の配置場所へ復元。
  - ベースフォルダが未設定の場合のみ、管理画面を表示してユーザーに選択を促す。
- **高精度な配置復元 (Geometry Persistence)**: [NEW]
  - **DPIスケール対応**: ウィンドウの位置・サイズを「論理ピクセル」として保存し、高解像度ディスプレイ環境でも再起動時にサイズが変わったりズレたりしないよう自動補正。
  - **柔軟なパース**: 付箋（Markdown）の Frontmatter に記載された `x, y, width(w), height(h)` を読み書き。短縮表記 (`w:`, `h:`) にも対応。
- **インライン・ダイレクト編集 (ダブルクリック)**: 
  - 閲覧モードの文章を**ダブルクリック**するだけで編集モードへ移行。
  - フォーカスが外れると自動保存し、閲覧モードへ復元。
- **重なり・重複の徹底排除 (Single Window Policy)**: [NEW]
  - 1つのファイルに対して開けるウィンドウは必ず**1つ**。
  - ファイルパスに基づいた一意のラベル管理と、ウィンドウ作成の「直列化キュー」により、同一ファイルの二重開きを物理的に防止。
  - 既に開いている付箋を再度開こうとした場合、既存のウィンドウを最小化解除・最前面へ移動。
- **高精度ホバー操作とコーナーガイド**:
  - 四隅（コーナー）にマウスを近づけた時だけ「📏サイズ連動」を表示。
- **ドラッグ＆ドロップ移動とジャストフィット**:
  - 余白を掴んで自由に移動。余白ダブルクリックで内容に合わせたサイズ自動調整。
- **「はがす」機能とゴミ箱連携**:
  - 不要になった付箋を「Trash」フォルダへ移動し、即座にウィンドウを消去。

## 技術スタック
- **Frontend**: Next.js 14 (App Router), React 18, Tailwind CSS
- **Backend**: Tauri v2 (Rust)
- **Markdown**: ReactMarkdown, remark-gfm, remark-breaks, rehype-raw
- **Persistence**: localStorage (フォルダパス), Frontmatter (配置情報), sessionStorage (初期化フラグ)

## UI/UX の極み (A6 Density & Paper Look)
- **フォント**: `BIZ UDPGothic` および `BIZ UDGothic` を採用し、Windows 上での圧倒的な視認性と美しいタイポグラフィを実現。
- **付箋色**: 薄黄色（`#f7e9b0` または `#FFF9C4`）の紙質を再現。
- **透過ウィンドウ**: Tauri の透過機能を活用し、デスクトップに溶け込む外観。

## システム要求
- **自動保存**: 編集中の内容を 800ms のデバウンスで逐次保存。
- **堅牢性**: Rust バックエンドでの文字列スライス時に、マルチバイト文字（日本語）の境界でクラッシュしない安全な読み込み処理を実装。

---
*更新日: 2026-01-05*  
*バージョン: Δ0.3*
