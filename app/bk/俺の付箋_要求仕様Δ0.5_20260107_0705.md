# 俺の付箋 (Ore no Fusen) 要求仕様書 Δ0.5

## プロジェクト概要
**「俺の付箋」**は、ローカル Markdown ファイルをデスクトップ上に貼り付けられた「付箋」のように扱うためのミニマリスト向けアプリケーションです。

## 主要機能と操作方法 (Features & Operations)

### 1. 付箋の作成と移動
- **新規作成**:
  - 付箋上で**右クリック**し、メニューから**「➕ 新規メモ」**を選択します。
  - 現在のフォルダに新しい付箋が作成され、別ウィンドウで開きます。
- **移動**:
  - 付箋の**余白（上部や下部）**をドラッグして、デスクトップ上の好きな場所に配置できます。

### 2. 編集と保存
- **編集**:
  - 付箋内の**テキストをシングルクリック**すると編集モードになります。
  - テキストを入力・修正できます。
- **自動保存**:
  - 入力を止めて少し待つと、自動的に保存されます。
  - 1行目のテキストがファイル名として自動的に使用されます。
- **リネーム**:
  - 1行目を書き換えると、自動的にファイル名も変更（リネーム）されます。編集中にリネームされても入力は中断されません。

### 3. デザイン変更
- **背景色の変更**:
  - 付箋上で**右クリック**し、**「🟡 イエロー」「🟢 グリーン」「🔵 ブルー」**から選択します。
  - 瞬時に付箋全体の色が切り替わります。

### 4. 削除
- **ゴミ箱へ移動**:
  - 付箋上で**右クリック**し、**「🗑️ ゴミ箱へ」**を選択します。
  - ファイルがゴミ箱に移動し、ウィンドウが閉じます。

## 技術的工夫とアーキテクチャ (Engineering & Architecture)

### 1. 構造改革（頭と手足の分離）
- **Orchestrator Pattern (page.tsx)**:
  - アプリの「頭脳」。フォルダ監視、URLパラメータ解釈、ウィンドウ生成指令を一元管理。
- **Autonomous Component (StickyNote.tsx)**:
  - アプリの「手足」。表示・編集・自身の状態保存（位置・サイズ）を自律的に担当。これによりコードの責務が明確化されました。

### 2. UX向上のための技術的工夫
- **Direct DOM Update (背景色)**:
  - Reactステート管理のみに依存せず、DOMのstyleプロパティを直接操作することで、ラグのない瞬時の色変更を実現。
- **Event Filtering (操作性)**:
  - 「クリックで編集」「ドラッグで移動」「右クリックでメニュー」という競合しやすい操作を、クリック位置とターゲット要素（テキストか余白か）の厳密な判定ロジックで快適に共存。
- **Seamless Renaming (編集維持)**:
  - ファイル名変更（リネーム）時に発生するURL変更イベントを検知し、それが「自身の編集によるもの」である場合は再ロードをスキップするロジック（`isRenamingRef`）を実装。これにより入力中の中断を防止。

### 3. レンダリングと堅牢性
- **Visual Fidelity (空白行維持)**:
  - 独自のMarkdownパーサーを実装し、空白行を正確にレンダリング。入力した見た目そのままの付箋を実現。
- **Rust Backend Delegation (安全性)**:
  - ゴミ箱移動やウィンドウ閉鎖などのシステム操作をRustバックエンドに移譲し、フロントエンドの非同期処理による不安定さを排除。

## 技術スタック
- **Frontend**: Next.js 14, React 18, Tailwind CSS
- **Backend**: Tauri v2 (Rust)

---
*作成日: 2026-01-07 07:09*  
*バージョン: Δ0.5*
