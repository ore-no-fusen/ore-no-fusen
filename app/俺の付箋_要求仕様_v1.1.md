# 俺の付箋 - 要求仕様書 v1.1

**バージョン**: 1.1  
**日付**: 2026-01-12  
**ステータス**: ✅ 基本機能FIX・エディタ強化完了

## 概要 (Overview)

「俺の付箋」は、Markdown ファイルをデスクトップ上の付箋として直接表示・編集できるミニマリスト・アプリケーションです。Obsidian Vault 等の Markdown 資産をそのまま活用でき、「**ファイルの中身 = ファイル名**」を自動同期し、従来のリンク切れを根本解決します。

## ユースケース定義 (Use Cases Ver 3.1)

### 共通事項
- **アクター**: ユーザー（Ore no Fusen 利用者）
- **システム境界**: アプリケーション（フロントエンド + バックエンド）

### 1. 初期化・セットアップ (Startup Phase)

#### UC-01: ベースフォルダの設定（初回起動）
- **アクター**: ユーザー
- **前提条件**: アプリが初回起動状態である（設定ファイル `settings.json` が存在しない、または無効）
- **基本フロー**:
  1. システムは設定ファイルの不在を検知し、「セットアップダイアログ」を表示する
  2. ユーザーは「A. 推奨作成（ドキュメント配下）」または「B. 既存フォルダ選択」を選ぶ
  3. [Aの場合]: システムは `Documents/OreNoFusen` を作成する
  4. [Bの場合]: ユーザーはフォルダ選択ダイアログで対象フォルダを指定する
  5. システムは決定されたパスを「ベースフォルダ」として設定ファイルに保存する
  6. ユーザーは「データの取り込み（インポート）」の要否を選択する（任意）
- **事後条件**: ベースフォルダが確定し、アプリが「通常起動モード」へ移行可能な状態になる

#### UC-02: データのインポート
- **アクター**: ユーザー
- **前提条件**: UC-01 のフロー内で、ユーザーがインポートを選択している
- **基本フロー**:
  1. ユーザーは「取り込み元フォルダ」を選択する
  2. システムは対象フォルダ内の全 `.md` ファイルを読み取る
  3. システムはファイル名を命名規則（`日付_1行目.md`）に適合するように変換しつつ、ベースフォルダへコピーする
- **事後条件**: 過去の資産がベースフォルダ内に複製され、利用可能になる（元データは変更されない）

#### UC-03: 環境構築（内部処理）
- **基本フロー**: ベースフォルダ作成時に、安全用の `trash`（ゴミ箱）フォルダも作成しておく

### 2. 付箋操作・編集 (Runtime Phase)

#### UC-06: 新規付箋の作成
- **基本フロー**:
  1. ユーザーは「新規メモ」を選択
  2. システムはベースフォルダ内に新規ファイル（例: `20260110_NewNote.md`）を作成
  3. 初期メタデータ（位置:マウス座標, 色:Yellow）を書き込み、画面に表示

#### UC-07: テキスト編集とファイル名同期 (Enhanced)
- **基本フロー**:
  1. ユーザーは高度なMarkdownエディタ（CodeMirror 6ベース）でテキスト入力。
  2. システムは0.8秒のディレイで自動保存。
  3. **「1行目の内容」と「現在のファイル名」を比較し、差異があればリネームする**（例: `日付_1行目.md`）。禁則文字は置換
- **エディタ機能の拡張 (v1.1)**:
  - **箇条書き（List）**: `- ` 記号をオレンジ色で強調表示。閲覧モードでは「•」に変換。
  - **チェックボックス（Task）**: `[ ]` 記号をオレンジ色で強調表示。
  - **複数行一括適用**: 複数行を選択してボタン（B, H1, List, Task）を押すと、全行に一括で記号を挿入/削除（スマートトグル）。
  - **スマート太字**: 選択範囲を `**` でトグル（ON/OFF）。二重装飾を防止。

#### UC-21: インタラクティブ・チェックボックス (v1.1新設)
- **基本フロー**:
  1. ユーザーは表示モード（閲覧モード）でチェックボックスアイコン（☐/☑）をクリックする。
  2. システムはエディタを起動せずに、内部テキストの該当行を `[ ]` ⇔ `[x]` に書き換える。
  3. システムは即座に表示を更新し、自動保存を実行する。

#### UC-08/09: メタデータ更新
- **基本フロー**: 移動・色変更時、フロントマターの `x`, `y`, `backgroundColor` のみを更新

#### UC-10: 付箋の削除（論理削除）
- **基本フロー**:
  1. ユーザーは「削除」を選択
  2. システムは対象ファイルを `trash` フォルダへ移動する（物理削除しない）
  3. 画面から消去

#### UC-11: エクスプローラーで開く
- **基本フロー**: ユーザーがコンテキストメニューから選択すると、システムはファイルマネージャーで実体を表示する

### 3. 表示とレイアウト (Layout Phase)

#### UC-20: 高度なレイアウト同期 (v1.1新設)
- **アクター**: システム
- **基本フロー**: 
  1. 編集モード（エディタ）と表示モード（レンダリング）の間で、フォント、余白、行高を完全に一致させる。
  2. モードを切り替えた際に、テキストの垂直・水平位置が1ピクセルも変動しない（WYSIWYG体験の提供）。
- **ツールバーの固定表示**: 長いメモをスクロールしても、装飾ボタンが常に画面最上部に追従（Sticky表示）する。

### 4. システム常駐 (System Tray)

#### UC-12: アプリケーション終了
- **基本フロー**: タスクトレイから「終了」を選択し、アプリを完全に終了する

#### UC-14/15: ボスキー (Boss Key)
- **基本フロー**: トレイアイコンから「全部隠す」「全部戻す」を選択し、全ウィンドウの表示/非表示を切り替える

## 主要機能と操作方法 (Features & Operations)

### 1. 付箋の作成と移動
- **新規作成**:
  - 付箋上で**右クリック**し、メニューから**「📝 新規メモ」**を選択します。
  - 現在のフォルダに新しい付箋が作成され、別ウィンドウで開きます。
- **移動とサイズ変更**:
  - 付箋の**余白（上部や下部）**をドラッグして移動できます。

### 2. 編集と装飾 (v1.1更新)
- **リッチ・エディタ**:
  - CodeMirror 6を採用し、Markdown記号をオレンジ色で見やすく装飾。
  - **ツールバーアイコン**: 直感的なSVGアイコンを採用。
- **スマート・トグル**: 
  - 単語や複数行を選択してボタンを押すと、適切に装飾を付与/解除。
  - 特に太字（B）は二重装飾（`****`）を防ぐ賢い挙動に改善。
- **閲覧モードでの直接操作**:
  - チェックボックスを直接クリックしてタスクを完了できます。

## 技術的工夫とアーキテクチャ (Engineering & Architecture)

### 5. レンダリングとUX (v1.1拡張)
- **Pixel-Perfect Alignment**:
  CodeMirrorの各行（`.cm-line`）と、Reactで描画する表示行の CSS プロパティを物理的に同一値に設定。
- **Sticky Toolbar**:
  `position: sticky` を利用し、スクロール領域内でもツールバーの操作性を維持。

(後略: Δ0.7以前のアーキテクチャ詳細はv1.0と同様)

---

*作成日: 2026-01-12*  
*バージョン: v1.1*  
*ステータス: ✅ 基本機能FIX・エディタ強化完了*
