# 俺の付箋 Δ0.5 構造改革：分離設計図

## ファイル構成

```
app/
├── page.tsx                    # Orchestrator（脳）
├── components/
│   └── StickyNote.tsx         # Note（手足）
└── 俺の付箋_要求仕様Δ0.5.md
```

---

## Orchestrator（脳）- `app/page.tsx`

### 責務
- ベースフォルダ管理
- `.md` ファイルスキャン
- ウィンドウ生成・復元
- グローバル状態管理

### 主要機能
```typescript
// 1. フォルダ選択
selectDirectory()

// 2. ノート一覧取得
loadNotes(folderPath)

// 3. ウィンドウ生成（キュー制御）
openNoteWindow(path, geometry)

// 4. 復元ロジック
restoreAllNotes()
```

### UI
- フォルダ選択画面
- ノート一覧（管理画面）
- ウィンドウ生成制御のみ

---

## Note（手足）- `app/components/StickyNote.tsx`

### 責務
- 単一ノートの表示・編集
- Frontmatter 管理
- ジオメトリ保存
- 背景色管理

### 主要機能
```typescript
// 1. コンテンツ読み込み
loadContent(path)

// 2. 編集モード切り替え
handleEditStart()
handleEditBlur()

// 3. 自動保存
autoSave()

// 4. ジオメトリ保存
saveWindowState()

// 5. 背景色変更
changeBackgroundColor(color)
```

### UI
- Markdown ビューア
- テキストエディタ
- ホバーバー
- 右クリックメニュー

---

## データフロー

```
Orchestrator
    ↓ (URL parameter: ?path=...)
StickyNote
    ↓ (invoke: fusen_read_note)
Rust Backend
    ↓ (file content)
StickyNote
    ↓ (invoke: fusen_save_note)
Rust Backend
```

---

## URL ルーティング

```
/                           → Orchestrator（管理画面）
/?path=<encoded_path>       → StickyNote（付箋表示）
```

---

## 状態管理の分離

### Orchestrator
- `folderPath`: ベースフォルダパス
- `files`: ノート一覧
- `windowQueue`: ウィンドウ生成キュー

### StickyNote
- `content`: ノート本文
- `isEditing`: 編集モード
- `noteBackgroundColor`: 背景色
- `rawFrontmatter`: Frontmatter 文字列

---

## 移行手順

1. `StickyNote.tsx` を新規作成
2. `page.tsx` から付箋関連ロジックを抽出
3. URL パラメータによる分岐を実装
4. 動作確認
5. 不要コードの削除
