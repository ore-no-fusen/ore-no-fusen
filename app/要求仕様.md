# 俺の付箋 (Ore no Fusen) 要求仕様書

## 1. 概要
ローカルにあるMarkdownファイル（Obsidian Vault等）を読み込み、デスクトップ上の「付箋」として常駐表示させることを目的としたWebアプリケーション。PWA（Progressive Web Apps）としてインストールして利用することを想定している。

## 2. 技術スタック
- **Framework**: Next.js (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS + Custom CSS (`app/globals.css`)
- **PWA Support**: `next-pwa`, Manifest, Service Worker
- **Local Access**: File System Access API

## 3. 機能要件

### 3.1 共通機能
- **ディレクトリ選択**: File System Access APIを使用し、ユーザーのローカルフォルダへのアクセス権を取得する。
- **ファイル読み込み**: 選択されたフォルダ内の `.md` ファイルをリストアップし、内容を表示する。
- **Markdownレンダリング**:
    - `react-markdown` を使用。
    - GitHub Flavored Markdown (`remark-gfm`) 対応。
    - 改行の保持 (`remark-breaks`) 対応。
- **状態保持**: 最後に選択したファイルパス（ファイル名）を `localStorage` に保存し、次回起動時に自動で復元を試みる。

### 3.2 通常モード (`/`)
- **レイアウト**: ヘッダー、左サイドバー（ファイル一覧）、メインエリア（プレビュー）の3カラム構成。
- **目的**: ファイルの内容確認、ブラウジング用。

### 3.3 付箋モード (`/?sticky=1`)
- **目的**: デスクトップの隅に置いておくための簡易表示モード。
- **レイアウト**:
    - ヘッダー・サイドバー等のナビゲーションを排除。
    - 画面全体を「付箋の紙」に見立てたデザイン。
- **ミニバー**:
    - 画面右上へのホバー時のみ表示される最小限の操作パネル。
    - 「フォルダ選択」「再読み込み」機能を配置。
- **独自コンテキストメニュー**:
    - 右クリック（contextmenu）イベントをフックし、独自のメニューを表示。
    - **「はがす」機能**:
        - 付箋を非表示（Dismissed）状態にする。
        - 状態は `localStorage` (`stickyDismissed`) に永続化され、次回起動時も維持される。
        - 可能な場合、`window.close()` を呼び出してウィンドウ自体を閉じる。
- **復帰フロー**:
    - 「はがされた」状態で起動した場合、復帰用のボタンを表示する。

## 4. デザイン仕様 (Sticky Mode)

### 4.1 コンセプト
- **紙の質感**: 薄いベージュ系の背景色を採用し、物理的な付箋のような見た目にする。
- **高密度**: 限られたスペースで多くの情報を表示できるよう、余白と行間を詰める。
- **視認性**: 日本語フォント（特に丸ゴシック系）を優先し、小さな文字でも読みやすくする。

### 4.2 スタイル定義
- **配色**:
    - Window背景: `#f3ecd9`
    - Paper背景: `#faf6ee`
- **タイポグラフィ**:
    - Font Family: "Hiragino Maru Gothic ProN", "BIZ UDPGothic", "Meiryo", sans-serif
    - Font Size: viewport幅に応じて可変 (clamp使用)、または固定 (15.5px) で調整。
    - Line Height: 1.35 〜 1.4 (Tight)
- **見出し統一**:
    - `h1` 〜 `h4` および「太字（`**text**`）のみの行」を、同一の「見出し」スタイルとしてレンダリングする。
    - これにより、Markdownの書き方に依存せず、視覚的な区切りを統一する。

## 5. PWA要件
- **インストール**: Edge / Chrome 等でデスクトップアプリとしてインストール可能であること。
- **Manifest**:
    - Name: "俺の付箋"
    - Display: `standalone`
    - Start URL: `/?sticky=1`
- **Service Worker**:
    - オフライン動作およびインストール要件を満たすために登録・稼働すること。
