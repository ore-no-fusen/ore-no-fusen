# 俺の付箋 - フロントマター仕様書

## 概要

各付箋ファイル（`.md`）は、YAML形式のフロントマターとMarkdown本文から構成されます。フロントマターには、付箋の表示状態や設定を保存します。

## フロントマター形式

```yaml
---
type: sticky
seq: 12
context: 
created: 2026-01-10
updated: 2026-01-10
backgroundColor: #f7e9b0
x: 1065
y: 11
width: 300
height: 400
fontFamily: BIZ UDGothic
fontSize: 8
lineHeight: 1.0
---

（ここに本文）
```

## フィールド定義

### システム管理フィールド（必須）

| フィールド | 型 | 説明 | 例 |
|----------|---|------|---|
| `type` | string | ノートタイプ（固定値） | `sticky` |
| `seq` | number | 連番（同一フォルダ内でユニーク） | `1`, `12`, `100` |
| `context` | string | コンテキスト（ファイル名の一部） | `基礎数値`, `TODO` |
| `created` | string | 作成日（YYYY-MM-DD） | `2026-01-10` |
| `updated` | string | 更新日（YYYY-MM-DD） | `2026-01-10` |

### 表示設定フィールド（維持対象）

| フィールド | 型 | デフォルト値 | 説明 |
|----------|---|-----------|------|
| `backgroundColor` | string | `#f7e9b0` | 付箋の背景色（16進数カラーコード） |
| `x` | number | （作成時の位置） | ウィンドウのX座標（ピクセル） |
| `y` | number | （作成時の位置） | ウィンドウのY座標（ピクセル） |
| `width` | number | `400` | ウィンドウの幅（ピクセル） |
| `height` | number | `300` | ウィンドウの高さ（ピクセル） |
| `fontFamily` | string | `BIZ UDGothic` | 使用フォント名 |
| `fontSize` | number | `8` | フォントサイズ（ピクセル） |
| `lineHeight` | number | `1.0` | 行間隔（倍数） |

## 背景色の定義

| 色名 | カラーコード | 説明 |
|-----|------------|------|
| 黄色（デフォルト） | `#f7e9b0` | 標準の付箋色 |
| 青 | `#b3d9ff` | 重要事項用 |
| ピンク | `#ffc0cb` | 緊急事項用 |

## 自動保存の動作

### 保存タイミング

1. **背景色変更時**: 色変更メニュー選択後、即座に保存
2. **ウィンドウ移動時**: 移動完了から800ms後に自動保存
3. **ウィンドウリサイズ時**: リサイズ完了から800ms後に自動保存
4. **本文編集時**: 最後の編集から800ms後に自動保存

### 保存される内容

- 背景色変更 → `backgroundColor`フィールドを更新
- 位置変更 → `x`, `y`フィールドを更新
- サイズ変更 → `width`, `height`フィールドを更新
- 本文編集 → `updated`フィールドとMarkdown本文を更新

## ファイル名規則

フォーマット: `{seq:04d}_{created}_{context}.md`

例:
- `0001_2026-01-10_基礎数値.md`
- `0012_2026-01-10_TODO.md`
- `0100_2026-01-10_.md` （コンテキストなし）

## 実装ノート

### フロントマター生成（新規作成時）

新規メモ作成時、以下のデフォルト値でフロントマターを生成：

```rust
// Rust側（src-tauri/src/logic.rs）
pub fn generate_frontmatter_full(
    seq: i32, 
    context: &str, 
    created: &str, 
    updated: &str
) -> String {
    format!(
        "---\ntype: sticky\nseq: {}\ncontext: {}\ncreated: {}\nupdated: {}\nbackgroundColor: #f7e9b0\nfontFamily: BIZ UDGothic\nfontSize: 8\nlineHeight: 1.0\n---\n",
        seq, context, created, updated
    )
}
```

### フロントマター更新（既存メモ）

位置やサイズの更新は、既存フロントマターのフィールドを部分更新：

```typescript
// フロントエンド（app/components/StickyNote.tsx）
const updateFrontmatterValue = (front: string, key: string, value: string | number) => {
    const regex = new RegExp(`(${key}:\\s*)(.*)`);
    if (regex.test(front)) {
        return front.replace(regex, `$1${value}`);
    } else {
        // フィールドが存在しない場合は追加
        const lastFence = front.lastIndexOf('---');
        return front.slice(0, lastFence) + `${key}: ${value}\n` + front.slice(lastFence);
    }
};
```

## 互換性

### 古いファイル形式

以下のフィールドを持たない古いファイルも読み込み可能：
- `fontFamily`, `fontSize`, `lineHeight` → CSSデフォルト値を使用
- `x`, `y` → ウィンドウ作成時の位置を使用
- `width`, `height` → デフォルトサイズ（400x300）を使用

### マイグレーション

既存ファイルを開いた際、不足しているフィールドは次回保存時に自動追加されます。

---

**最終更新**: 2026-01-10
**バージョン**: 1.0
