# 俺の付箋（Ore no Fusen）要求仕様 Δ0.1（Tauri・Obsidian md）

本仕様は、Tauri デスクトップアプリとして動作する「俺の付箋」の **最小完成仕様（Δ0.1）** を定義する。  
本バージョンでは **ローカル Markdown（Obsidian 管理）を正** とし、「一瞬で判断できる付箋」を成立させることを目的とする。

---

## 1. 基本方針
- アプリ形態：**Tauri デスクトップアプリ**
- データ正：**ローカル Markdown（.md）**
- 管理場所：**Obsidian Vault 内の専用フォルダ**
- 本アプリは「md を読む／更新する窓」であり、DBやクラウドを持たない（Δ0.1では同期なし）

---

## 2. フォルダ構成
```text
Obsidian Vault/
└─ StickyNotes/
   ├─ 0001_2026-01-02_INV基礎数値.md
   └─ Trash/
```
- 付箋はすべて `StickyNotes/` 配下に置く
- 「はがす」操作は `Trash/` へ移動（復元可能）

---

## 3. ファイル名ルール（確定）
```text
NNNN_YYYY-MM-DD_Context.md
```
- **NNNN**：連番（既存最大値 +1、作成後は固定）
- **YYYY-MM-DD**：更新日（**1日1回のみ更新**：日付が変わった最初の保存時にだけ更新・リネーム）
- **Context**：付箋の用途・文脈を表す名前（例：INV基礎数値）

---

## 4. Markdown フォーマット（正）

### 4.1 frontmatter（表示・位置）
```md
---
type: sticky
seq: 1
context: INV基礎数値
created: 2026-01-02
updated: 2026-01-02
x: 320
y: 180
w: 420
h: 240
fontFamily: BIZ UDGothic
fontSize: 8
lineHeight: 1.0
backgroundColor: "#FFF9C4"
---
```

---

## 5. 表示仕様（Sticky UI）

### 5.1 基本
- スクロール：**なし**
- 約 30 行を一望できること（読みではなく「即判断」）

### 5.2 タイポグラフィ（確定）
| 項目 | 値 |
|---|---|
| フォント | BIZ UDGothic |
| サイズ | 8px |
| 行間 | 1.0 |

### 5.3 色（確定）
- 背景色：固定 `#FFF9C4`
- 文字色：2種のみ（**意味は「通常」と「ポイント」**）
  - 黒 `#000000`：通常
  - 赤 `#D32F2F`：ポイント

---

## 6. 構造表現ルール（最重要）

### 6.1 階層（最大3段）
| レベル | 表現 | 意味 |
|---|---|---|
| Lv1 | **太字・インデントなし** | セクション／段落 |
| Lv2 | 通常・インデント1 | 内容 |
| Lv3 | 通常・インデント2 | 補足 |

- インデント：**スペース2つ = 1段**
- **太字は構造専用**（強調に使わない）

### 6.2 強調
- ポイントは **赤文字**
- 赤＋太字は **Lv1見出しのみ許可**

---

## 7. 操作仕様（Δ0.1）
- 起動時：`StickyNotes/` を読み込み付箋生成
- 編集／移動／サイズ変更：即 md 上書き保存（オートセーブ）
- 右クリック：独自メニュー
  - **はがす**：対象 md を `Trash/` に移動し、UIから消す
  - **ポイント切替**：選択行を「黒⇄赤」切替（2値）

---

## 8. Tauri Command API（実装I/F）

### 8.1 コマンド一覧（必須）
| command | 入力 | 出力 | 備考 |
|---|---|---|---|
| `select_folder()` | なし | `folderPath` | 初回のみ。キャンセル可 |
| `list_notes(folderPath)` | string | `NoteMeta[]` | `StickyNotes/` を走査 |
| `read_note(path)` | string | `Note` | 1ファイル読み込み |
| `create_note(folderPath, context)` | string, string | `Note` | 連番=最大+1 |
| `save_note(path, body, frontmatter)` | string, string, dict | `ok` | 更新日ルール適用 |
| `move_to_trash(path)` | string | `newPath` | `Trash/` へ移動 |
| `rename_note(path, newPath)` | string, string | `ok` | 更新日で日付部のみ更新 |

### 8.2 データ型（最小）
- `NoteMeta`：`path, seq, context, updated`
- `Note`：`meta + body + frontmatter`

### 8.3 更新日「1日1回」ルール（実装規則）
- 保存時に `updated` の日付と今日の日付を比較
- 日付が変わっていたら：`updated` 更新 → ファイル名の `YYYY-MM-DD` を今日にして **1回だけリネーム**
- 同日内の保存ではリネームしない

---

## 9. 初期付箋（INV基礎数値）本文（Δ0.1適合）

```md
**車両目標**
  出力：登坂性能、トルク：段差乗り越え、回転数：最高速

**性能目標（モータハード）**
  Fr 150kW/290Nm/17500rpm
  Rr 230kW/360Nm（～800A）/17500rpm
  電圧：376V（定格）/ 650V（MAX）/ PN400V
  電流：～800A

**性能目標（モータ制御）**
  定常トルク精度：±2%以下
    （<100Nm は ±2Nm以下）
  トルク応答：時定数 8ms以下 / 10ms ≒70%
  トルクリプル（p-p）：Fr ≤3.3Nm以下 / Rr ≤2.35Nm以下
  回転数精度：30rpm以下（p-p 60rpm以下）
  回転数応答：20Hz位相遅れ 45°以下

**制約（機能安全）**
  <span style="color:#D32F2F">QMトルク（モータ軸）：≤118Nm</span>
    （前提：車両Δ0.15G以下 / R=0.33m / Gear=10 / 車重=2.28t）
  <span style="color:#D32F2F">FTTI：0.25s</span>

**制約（車両）**
  トルク変化率：30Nm/ms以下
  抜き方向：車両ジャーク ≥ −0.173 G/s
    （トルク抜き時にガクッとさせないための下限）

**その他**
  発熱：3.8kW → 0.11kW
```

---

以上をもって **俺の付箋_要求仕様 Δ0.1** とする。
