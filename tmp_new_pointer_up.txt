    const onArticlePointerUp = (e: React.PointerEvent) => {
        // [Refactor] Use setTimeout(0) to wait for selection to settle.
        // Capture coordinates for single click fallback
        const clientX = e.clientX;
        const clientY = e.clientY;

        pointerDownRef.current = null;

        setTimeout(() => {
            // 1. Check for valid selection (Double click or Drag)
            const sel = window.getSelection();
            if (sel && sel.rangeCount > 0 && sel.toString().length > 0) {
                console.log('[Pointer] Selection detected:', sel.toString());
                const range = sel.getRangeAt(0);
                const start = calcOffsetFromDomPoint(range.startContainer, range.startOffset);
                const end = calcOffsetFromDomPoint(range.endContainer, range.endOffset);

                if (start !== null && end !== null) {
                    pendingSelectionRef.current = normalizeRange(start, end);
                    handleEditStart(); // Selection will be applied by useEffect
                    return;
                }
            }

            // 2. No selection -> Single Click (Cursor positioning)
            // Use caretRangeFromPoint for precise offset
            // (Avoids jumping to line start caused by unstable window.getSelection() on click)
            console.log('[Pointer] No selection, calculating caret position from point.');
            
            let clickOffset = 0;
            // @ts-ignore - caretRangeFromPoint is widely supported but might be missing in TS lib
            if (document.caretRangeFromPoint) {
                 // @ts-ignore
                const range = document.caretRangeFromPoint(clientX, clientY);
                if (range) {
                    const offset = calcOffsetFromDomPoint(range.startContainer, range.startOffset);
                    if (offset !== null) {
                        clickOffset = offset;
                        console.log('[Pointer] Calculated offset from point:', clickOffset);
                    }
                }
            } 

            handleEditStart(clickOffset);
        }, 0);
    };
